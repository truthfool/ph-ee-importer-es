{"attributes":{"description":"","kibanaSavedObjectMeta":{"searchSourceJSON":"{"query":{"language":"lucene","query":""},"filter":[]}"},"title":"Vega Visualisation 3: Pie chart for transactions above filter","uiStateJSON":"{}","version":1,"visState":"{"title":"Vega Visualisation 3: Pie chart for transactions above filter","type":"vega","aggs":[],"params":{"spec":"{\n  $schema: https://vega.github.io/schema/vega-lite/v5.json\n  title: Event counts from all indexes\n  data: {\n    url: {\n      index: _all\n      body: {\n        aggs: {\n          categories: {\n            terms: {\n              field: value.processInstanceKey\n            }\n            aggs: {\n              duration: {\n                scripted_metric: {\n                  init_script: state.responses = ['start':0,'stop':0]\n                  map_script: def intent = doc['intent'].value; def time = doc['timestamp'].value.getMillis(); state.responses.start = time; if (intent.contains('COMPLETED') && time > state.responses['stop']) { state.responses.stop = time;} else if(intent.contains('CREATED') && time < state.responses['start'] ) {state.responses.start = time;}\n                  combine_script: state.responses\n                  reduce_script: def diff = null;for (responses in states) {diff = responses['stop'] - responses['start'];}return diff;\n                }\n              }\n            }\n          }\n        }\n        size: 0\n        query: {\n          bool: {\n            must: [\n            ]\n            filter: [\n              {\n                match_all: {\n                }\n              }\n              {\n                match_phrase: {\n                  value.bpmnProcessId: mpesa-flow-v3\n                }\n              }\n            ]\n            should: [\n            ]\n            must_not: [\n            ]\n          }\n        }\n      }\n    }\n    format: {\n      property: aggregations.categories.buckets\n    }\n  }\n  transform: [\n    {\n      calculate: \"datum['duration.value'] > 120000 ? 'above 2 min' : 'below 2 min' \"\n      as: diff\n    }\n  ]\n  mark: arc\n  encoding: {\n    theta: {\n      field: duration.value\n      aggregate: count\n      type: quantitative\n    }\n    color: {\n      field: diff\n      type: nominal\n      axis: {\n        title: Process Instance\n      }\n    }\n  }\n}"}}"},"coreMigrationVersion":"7.13.2","id":"04748e40-7771-11ec-80b6-cdd557ff9b70","migrationVersion":{"visualization":"7.13.1"},"references":[],"type":"visualization","updated_at":"2022-01-17T08:40:40.620Z","version":"WzEwNTI1LDEzXQ=="}
{"exportedCount":1,"missingRefCount":0,"missingReferences":[]}